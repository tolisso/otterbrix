<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>JSONBench â€” a Benchmark For Data Analytics On JSON</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">

    <style>
        :root {
            --color: black;
            --title-color: black;
            --background-color: white;

            --link-color: #08F;
            --link-hover-color: #F40;

            --selector-text-color: black;
            --selector-active-text-color: black;
            --selector-background-color: #EEE;
            --selector-active-background-color: #FFCB80;
            --selector-hover-text-color: black;
            --selector-hover-background-color: #FDB;

            --summary-every-other-row-color: #F8F8F8;
            --highlight-color: #EEE;

            --bar-color1: oklch(calc(0.9 - 0.6) 0.1 calc(90 - 60));
            --bar-color2: oklch(calc(0.9 - 0.4) 0.1 calc(90 - 40));
            --bar-color3: oklch(calc(0.9 - 0.1) 0.1 calc(90 - 20));
            --bar-color4: oklch(0.9 0.1 90);

            --bar-color: #FFCB80;
            --fake-bar-color: #CCC;

            --tooltip-text-color: white;
            --tooltip-background-color: black;

            --nothing-selected-color: #CCC;
            --shadow-color: grey;
        }

        [data-theme="dark"] {
            --color: #CCC;
            --title-color: white;
            --background-color: #04293A;

            --link-color: #8CF;
            --link-hover-color: #FFF;

            --selector-text-color: white;
            --selector-background-color: #444;
            --selector-active-text-color: white;
            --selector-active-background-color: #088;
            --selector-hover-text-color: black;
            --selector-hover-background-color: white;

            --summary-every-other-row-color: #042e41;
            --highlight-color: #064663;

            --bar-color1: oklch(calc(0.4 + 0.6) 0.1 calc(250 - 180));
            --bar-color2: oklch(calc(0.4 + 0.4) 0.1 calc(250 - 120));
            --bar-color3: oklch(calc(0.4 + 0.2) 0.1 calc(250 - 60));
            --bar-color4: oklch(0.4 0.1 250);

            --bar-color: #088;
            --fake-bar-color: #666;

            --tooltip-text-color: white;
            --tooltip-background-color: #444;

            --nothing-selected-color: #666;
            --shadow-color: black;
        }

        html, body {
            color: var(--color);
            background-color: var(--background-color);
            width: 100%;
            height: 100%;
            margin: 0;
            overflow: auto;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            padding: 1% 3% 0 3%;
        }

        h1 {
            color: var(--title-color);
        }

        table {
             border-spacing: 1px;
        }

        .stick-left {
            position: sticky;
            left: 0px;
        }

        .selectors-container {
            padding: 2rem 0 2rem 0;
            user-select: none;
        }

        .selectors-container th {
            text-align: left;
            vertical-align: top;
            white-space: nowrap;
            padding-top: 0.5rem;
            padding-right: 1rem;
        }

        .selector {
            display: inline-block;
            margin-left: 0.1rem;
            padding: 0.2rem 0.5rem 0.2rem 0.5rem;
            background: var(--selector-background-color);
            color: var(--selector-text-color);
            border: 0.2rem solid var(--background-color);
            border-radius: 0.5rem;
        }

        .selector-active {
            color: var(--selector-active-text-color);
            background: var(--selector-active-background-color);
        }

        a, a:visited {
            text-decoration: none;
            color: var(--link-color);
            cursor: pointer;
        }

        a:hover {
            color: var(--link-hover-color);
        }

        .selector:hover {
            color: var(--selector-hover-text-color) !important;
            background: var(--selector-background-color);
        }

        .selector-active:hover {
            background: var(--selector-hover-background-color);
        }

        #summary tr:nth-child(odd) {
            background: var(--summary-every-other-row-color);
        }

        .summary-name {
            white-space: nowrap;
            text-align: right;
            padding-right: 1rem;
        }

        .summary-bar-cell {
            width: 100%;
        }

        .summary-bar {
            height: 1rem;
            width: 100%;
        }

        .summary-bar-fake {
            height: 1rem;
            background: var(--fake-bar-color);
            border-radius: 0 0.2rem 0.2rem 0;
        }

        .summary-number {
            font-family: monospace;
            text-align: right;
            padding-left: 1rem;
            white-space: nowrap;
        }

        th {
            padding-bottom: 0.5rem;
        }

        .th-entry-hilite {
            background: var(--highlight-color);
            font-weight: bold;
        }

        .summary-row:hover, .summary-row-hilite {
            background: var(--highlight-color) !important;
            font-weight: bold;
        }

        #details {
            padding-bottom: 1rem;
        }

        #details th {
            vertical-align: bottom;
        }

        #details td {
            white-space: pre;
            font-family: monospace;
            text-align: right;
            padding: 0.1rem 0.5rem 0.1rem 0.5rem;
        }

        .shadow:hover {
            box-shadow: 0 0 1rem var(--shadow-color);
            position: relative;
        }

        #nothing-selected {
            display: none;
            font-size: 32pt;
            font-weight: bold;
            color: var(--nothing-selected-color);
        }

        .note {
            position: relative;
            display: inline-block;
        }

        .tooltip {
            position: absolute;
            bottom: calc(100% + 0.5rem);
            visibility: hidden;
            background-color: var(--tooltip-background-color);
            color: var(--tooltip-text-color);
            box-shadow: 0 0 1rem var(--shadow-color);
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            z-index: 1;
            text-align: left;
            white-space: normal;
        }

        .tooltip-result {
            left: calc(50% - 0.25rem);
            width: 20rem;
            margin-left: -10rem;
        }

        .tooltip-query {
            left: 0;
            width: 40rem;
            margin-left: -3rem;
        }

        .note:hover .tooltip {
            visibility: visible;
        }

        .tooltip::after {
            content: " ";
            position: absolute;
            top: 100%;
            border-width: 0.5rem;
            border-style: solid;
            border-color: var(--tooltip-background-color) transparent transparent transparent;
        }

        .tooltip-result::after {
            left: 50%;
            margin-left: -1rem;
        }

        .tooltip-query::after {
            left: 3rem;
            margin-left: 0.5rem;
        }

        .nowrap {
            text-wrap: none;
        }

        .themes {
            float: right;
            font-size: 200%;
            cursor: pointer;
        }

        #toggle-dark, #toggle-light {
            padding-right: 0.5rem;
            cursor: pointer;
        }

        #toggle-dark:hover, #toggle-light:hover {
            display: inline-block;
            transform: translate(1px, 1px);
            filter: brightness(125%);
        }

        #scale_hint {
            font-weight: normal;
            font-size: 80%;
            filter: contrast(10%);
        }
    </style>
    <script type="text/javascript">

const queries = [
"SELECT data.commit.collection AS event, count() AS count FROM bluesky GROUP BY event ORDER BY count DESC",
"SELECT data.commit.collection AS event, count() AS count, uniqExact(data.did) AS users FROM bluesky WHERE data.kind = 'commit' AND data.commit.operation = 'create' GROUP BY event ORDER BY count DESC",
"SELECT data.commit.collection AS event, toHour(fromUnixTimestamp64Micro(data.time_us)) as hour_of_day, count() AS count FROM bluesky WHERE data.kind = 'commit' AND data.commit.operation = 'create' AND data.commit.collection in ['app.bsky.feed.post', 'app.bsky.feed.repost', 'app.bsky.feed.like'] GROUP BY event, hour_of_day ORDER BY hour_of_day, event",
"SELECT data.did::String as user_id, min(fromUnixTimestamp64Micro(data.time_us)) as first_post_ts FROM bluesky WHERE data.kind = 'commit' AND data.commit.operation = 'create' AND data.commit.collection = 'app.bsky.feed.post' GROUP BY user_id ORDER BY first_post_ts ASC LIMIT 3",
"SELECT data.did::String as user_id, date_diff( 'milliseconds', min(fromUnixTimestamp64Micro(data.time_us)), max(fromUnixTimestamp64Micro(data.time_us))) AS activity_span FROM bluesky WHERE data.kind = 'commit' AND data.commit.operation = 'create' AND data.commit.collection = 'app.bsky.feed.post' GROUP BY user_id ORDER BY activity_span DESC LIMIT 3",
];

const data = [
{"system":"data.json.gz","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"total_size":134117979655,"source":"_files_gz/results/_files_bluesky_gz_1000m.json"}
,{"system":"data.json.gz","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"total_size":13372936569,"source":"_files_gz/results/_files_bluesky_gz_100m.json"}
,{"system":"data.json.gz","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"total_size":1354902507,"source":"_files_gz/results/_files_bluesky_gz_10m.json"}
,{"system":"data.json.gz","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"total_size":135176827,"source":"_files_gz/results/_files_bluesky_gz_1m.json"}
,{"system":"data.json","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"total_size":482108809691,"source":"_files_json/results/_files_bluesky_json_1000m.json"}
,{"system":"data.json","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"total_size":47813179260,"source":"_files_json/results/_files_bluesky_json_100m.json"}
,{"system":"data.json","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"total_size":4858741288,"source":"_files_json/results/_files_bluesky_json_10m.json"}
,{"system":"data.json","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"total_size":480778277,"source":"_files_json/results/_files_bluesky_json_1m.json"}
,{"system":"data.json.lz4","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"total_size":206562787263,"source":"_files_lz4/results/_files_bluesky_lz4_1000m.json"}
,{"system":"data.json.lz4","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"total_size":20591959778,"source":"_files_lz4/results/_files_bluesky_lz4_100m.json"}
,{"system":"data.json.lz4","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"total_size":2084888024,"source":"_files_lz4/results/_files_bluesky_lz4_10m.json"}
,{"system":"data.json.lz4","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"total_size":208385826,"source":"_files_lz4/results/_files_bluesky_lz4_1m.json"}
,{"system":"data.json.zstd","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"total_size":123797963671,"source":"_files_zstd/results/_files_bluesky_zstd_1000m.json"}
,{"system":"data.json.zstd","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"total_size":12245368182,"source":"_files_zstd/results/_files_bluesky_zstd_100m.json"}
,{"system":"data.json.zstd","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"total_size":1269817486,"source":"_files_zstd/results/_files_bluesky_zstd_10m.json"}
,{"system":"data.json.zstd","fake":true,"date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"total_size":126734406,"source":"_files_zstd/results/_files_bluesky_zstd_1m.json"}
,{"system":"ClickHouse","version":"25.11","os":"Ubuntu 24.04","date":"2025-11-15","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"num_loaded_documents":999999258,"total_size":99560268152,"data_size":99068986216,"index_size":491281201,"result":[[0.492,0.617,0.225],[16.298,3.241,3.236],[31.711,2.136,2.174],[6.985,0.480,0.479],[7.393,0.518,0.514]],"source":"clickhouse/results/m6i.8xlarge_bluesky_1000m.json"}
,{"system":"ClickHouse","version":"25.11","os":"Ubuntu 24.04","date":"2025-11-15","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"num_loaded_documents":99999968,"total_size":9662241335,"data_size":9645940572,"index_size":16300557,"result":[[0.077,0.247,0.027],[2.322,0.404,0.402],[2.680,0.214,0.220],[0.234,0.081,0.079],[0.513,0.088,0.091]],"source":"clickhouse/results/m6i.8xlarge_bluesky_100m.json"}
,{"system":"ClickHouse","version":"25.11","os":"Ubuntu 24.04","date":"2025-11-15","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"num_loaded_documents":9999994,"total_size":1001159528,"data_size":1000084752,"index_size":1074709,"result":[[0.010,0.049,0.006],[0.151,0.107,0.102],[0.051,0.036,0.037],[0.079,0.043,0.040],[0.075,0.046,0.045]],"source":"clickhouse/results/m6i.8xlarge_bluesky_10m.json"}
,{"system":"ClickHouse","version":"25.11","os":"Ubuntu 24.04","date":"2025-11-15","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":98534792,"data_size":98424457,"index_size":110328,"result":[[0.007,0.045,0.004],[0.042,0.035,0.022],[0.022,0.013,0.012],[0.033,0.017,0.017],[0.041,0.020,0.019]],"source":"clickhouse/results/m6i.8xlarge_bluesky_1m.json"}
,{"system":"Apache Doris","version":"doris-3.0.5-rc01-e277cfb83f","os":"Ubuntu 24.04","date":"2025-05-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"num_loaded_documents":999999994,"total_size":214623810748,"data_size":214623810748,"result":[[2.02,1.63,1.63],[96.02,6.61,6.64],[21.89,2.15,1.78],[10.26,0.95,0.93],[1.04,1.03,1.04]],"source":"doris/results/m6i.8xlarge_bluesky_1000m.json"}
,{"system":"Apache Doris","version":"doris-3.0.5-rc01-e277cfb83f","os":"Ubuntu 24.04","date":"2025-05-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"num_loaded_documents":100000000,"total_size":21304111530,"data_size":21304111530,"result":[[0.23,0.19,0.18],[9.39,0.77,0.77],[1.12,0.19,0.19],[0.17,0.15,0.17],[0.19,0.17,0.16]],"source":"doris/results/m6i.8xlarge_bluesky_100m.json"}
,{"system":"Apache Doris","version":"doris-3.0.5-rc01-e277cfb83f","os":"Ubuntu 24.04","date":"2025-05-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"num_loaded_documents":10000000,"total_size":2170032226,"data_size":2170032226,"result":[[0.05,0.04,0.04],[0.58,0.12,0.12],[0.06,0.04,0.05],[0.04,0.03,0.04],[0.04,0.04,0.04]],"source":"doris/results/m6i.8xlarge_bluesky_10m.json"}
,{"system":"Apache Doris","version":"doris-3.0.5-rc01-e277cfb83f","os":"Ubuntu 24.04","date":"2025-05-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":207785820,"data_size":207785820,"result":[[0.03,0.02,0.02],[0.06,0.04,0.05],[0.04,0.02,0.03],[0.03,0.02,0.02],[0.03,0.02,0.02]],"source":"doris/results/m6i.8xlarge_bluesky_1m.json"}
,{"system":"DuckDB","version":"1.1.3","os":"Ubuntu 24.04","date":"2025-03-27","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"num_loaded_documents":974400000,"total_size":472599756800,"result":[[3734.026,3722.939,3717.611],[3737.451,3726.788,3721.045],[3734.092,3722.939,3717.631],[3737.381,3724.588,3719.273],[3737.908,3726.648,3722.804]],"source":"duckdb/results/m6i.8xlarge_bluesky_1000m.json"}
,{"system":"DuckDB","version":"1.1.3","os":"Ubuntu 24.04","date":"2025-03-27","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"num_loaded_documents":98700000,"total_size":47184347136,"result":[[367.536,5.485,5.487],[367.771,15.209,15.225],[367.548,13.420,13.357],[367.689,7.544,7.576],[367.900,8.177,8.120]],"source":"duckdb/results/m6i.8xlarge_bluesky_100m.json"}
,{"system":"DuckDB","version":"1.1.3","os":"Ubuntu 24.04","date":"2025-03-27","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"num_loaded_documents":9700000,"total_size":4753981440,"result":[[36.379,0.612,0.609],[36.357,1.611,1.608],[36.310,1.551,1.561],[36.337,1.028,1.108],[36.372,1.113,1.118]],"source":"duckdb/results/m6i.8xlarge_bluesky_10m.json"}
,{"system":"DuckDB","version":"1.1.3","os":"Ubuntu 24.04","date":"2025-03-27","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":485490688,"result":[[3.554,0.112,0.111],[3.441,0.324,0.321],[2.921,0.329,0.339],[2.961,0.255,0.255],[3.131,0.262,0.262]],"source":"duckdb/results/m6i.8xlarge_bluesky_1m.json"}
,{"system":"Elasticsearch (no source)","version":"8.17.0","os":"Ubuntu 24.04","date":"2025-01-14","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"no","tags":[],"dataset_size":1000000000,"num_loaded_documents":999998998,"total_size":235840659266,"result":[[5.022,5.019,5.078],[51.486,45.510,45.713],[41.789,41.359,41.608],[8.807,8.812,8.711],[9.696,9.723,9.533]],"source":"elasticsearch/results/m6i.8xlarge_bluesky_no_source_1000m.json"}
,{"system":"Elasticsearch (no source)","version":"8.17.0","os":"Ubuntu 24.04","date":"2025-01-14","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"no","tags":[],"dataset_size":100000000,"num_loaded_documents":99999947,"total_size":21268479403,"result":[[2.532,2.536,2.486],[23.194,22.932,23.188],[19.521,19.321,19.159],[2.867,2.791,2.884],[3.099,3.136,3.171]],"source":"elasticsearch/results/m6i.8xlarge_bluesky_no_source_100m.json"}
,{"system":"Elasticsearch (no source)","version":"8.17.0","os":"Ubuntu 24.04","date":"2025-01-14","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"no","tags":[],"dataset_size":10000000,"num_loaded_documents":9999998,"total_size":2834172690,"result":[[0.270,0.263,0.275],[2.942,2.683,2.655],[2.014,2.008,2.037],[0.414,0.412,0.437],[0.562,0.470,0.463]],"source":"elasticsearch/results/m6i.8xlarge_bluesky_no_source_10m.json"}
,{"system":"Elasticsearch (no source)","version":"8.17.0","os":"Ubuntu 24.04","date":"2025-01-14","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"no","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":400948257,"result":[[0.041,0.037,0.035],[0.426,0.321,0.323],[0.192,0.186,0.213],[0.056,0.052,0.053],[0.099,0.061,0.060]],"source":"elasticsearch/results/m6i.8xlarge_bluesky_no_source_1m.json"}
,{"system":"Elasticsearch","version":"8.17.0","os":"Ubuntu 24.04","date":"2025-01-14","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"num_loaded_documents":999999101,"total_size":386099682721,"result":[[3.854,3.884,4.081],[37.078,29.084,28.548],[24.382,24.279,23.570],[8.106,8.228,8.080],[9.208,8.994,9.084]],"source":"elasticsearch/results/m6i.8xlarge_bluesky_source_1000m.json"}
,{"system":"Elasticsearch","version":"8.17.0","os":"Ubuntu 24.04","date":"2025-01-14","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"num_loaded_documents":99999947,"total_size":34182479705,"result":[[2.765,2.718,2.799],[20.788,20.822,20.270],[16.306,16.642,15.693],[2.454,2.461,2.423],[2.761,2.768,2.784]],"source":"elasticsearch/results/m6i.8xlarge_bluesky_source_100m.json"}
,{"system":"Elasticsearch","version":"8.17.0","os":"Ubuntu 24.04","date":"2025-01-14","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"num_loaded_documents":9999998,"total_size":3785308904,"result":[[0.286,0.290,0.287],[2.487,2.367,2.406],[1.747,1.671,1.656],[0.368,0.360,0.364],[0.423,0.424,0.422]],"source":"elasticsearch/results/m6i.8xlarge_bluesky_source_10m.json"}
,{"system":"Elasticsearch","version":"8.17.0","os":"Ubuntu 24.04","date":"2025-01-14","machine":"m6i.8xlarge, 16000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":400974094,"result":[[0.039,0.036,0.036],[0.344,0.303,0.305],[0.171,0.166,0.159],[0.047,0.047,0.049],[0.056,0.056,0.056]],"source":"elasticsearch/results/m6i.8xlarge_bluesky_source_1m.json"}
,{"system":"GreptimeDB","version":"v0.13.0-nightly-20250315","os":"Ubuntu 24.04","date":"2025-03-17","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"no","tags":[],"dataset_size":1000000000,"num_loaded_documents":999999233,"total_size":108808568186,"data_size":108803782584,"index_size":4656890,"result":[[13.643,1.568,1.553],[93.269,22.235,21.625],[2.176,2.081,2.086],[0.507,0.427,0.439],[1.694,1.614,1.606]],"source":"greptimedb/results/m6i.8xlarge_bluesky_1000m.json"}
,{"system":"GreptimeDB","version":"v0.13.0-nightly-20250315","os":"Ubuntu 24.04","date":"2025-03-17","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"no","tags":[],"dataset_size":100000000,"num_loaded_documents":99999968,"total_size":10824010669,"data_size":10823634560,"index_size":348813,"result":[[0.5,0.167,0.164],[10.711,3.362,3.324],[0.314,0.225,0.228],[0.146,0.069,0.068],[0.308,0.22,0.206]],"source":"greptimedb/results/m6i.8xlarge_bluesky_100m.json"}
,{"system":"GreptimeDB","version":"v0.13.0-nightly-20250315","os":"Ubuntu 24.04","date":"2025-03-17","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"no","tags":[],"dataset_size":10000000,"num_loaded_documents":9999994,"total_size":1136875364,"data_size":1136814387,"index_size":55651,"result":[[0.172,0.029,0.028],[0.46,0.386,0.421],[0.146,0.044,0.034],[0.121,0.023,0.023],[0.156,0.064,0.051]],"source":"greptimedb/results/m6i.8xlarge_bluesky_10m.json"}
,{"system":"GreptimeDB","version":"v0.13.0-nightly-20250315","os":"Ubuntu 24.04","date":"2025-03-17","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"no","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":112555783,"data_size":112546830,"index_size":7048,"result":[[0.148,0.012,0.012],[0.184,0.064,0.064],[0.116,0.014,0.024],[0.111,0.016,0.014],[0.122,0.017,0.034]],"source":"greptimedb/results/m6i.8xlarge_bluesky_1m.json"}
,{"system":"MongoDB","version":"8.0.6","os":"Ubuntu 24.04","date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"num_loaded_documents":893632990,"total_size":176737361920,"data_size":131007311872,"index_size":45730050048,"result":[[1472.45,1109.15,1054.37],[20715.1,20484.9,20461.8],[1218.37,1216.24,1217.69],[169.069,170.265,168.797],[174.406,173.932,173.268]],"source":"mongodb/results/m6i.8xlarge_bluesky_1000m.json"}
,{"system":"MongoDB","version":"8.0.6","os":"Ubuntu 24.04","date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"num_loaded_documents":94408000,"total_size":19315617792,"data_size":13590446080,"index_size":5725171712,"result":[[113.722,108.665,108.909],[1551.96,1563.52,1542.5],[141.132,138.307,140.456],[21.948,21.717,21.424],[23.103,22.574,22.302]],"source":"mongodb/results/m6i.8xlarge_bluesky_100m.json"}
,{"system":"MongoDB","version":"8.0.6","os":"Ubuntu 24.04","date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"num_loaded_documents":7860000,"total_size":1536905216,"data_size":1171361792,"index_size":365543424,"result":[[10.334,10.266,10.298],[37.401,36.807,37.979],[13.209,12.799,12.889],[2.071,2.029,2.119],[2.165,2.076,2.119]],"source":"mongodb/results/m6i.8xlarge_bluesky_10m.json"}
,{"system":"MongoDB","version":"8.0.6","os":"Ubuntu 24.04","date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":954368,"data_size":4096,"index_size":950272,"result":[[1.324,1.338,1.341],[1.815,1.823,1.832],[1.555,1.603,1.532],[0.249,0.256,0.266],[0.267,0.278,0.276]],"source":"mongodb/results/m6i.8xlarge_bluesky_1m.json"}
,{"system":"PostgreSQL","version":"16.6","os":"Ubuntu 24.04","date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"num_loaded_documents":804000000,"total_size":660356890624,"data_size":512144687104,"index_size":148180910080,"result":[[3904.83,3884.18,3884.17],[32594.9,32590.5,4277.8],[4249.8,4253.34,4927.79],[4903.66,4907.09,4947.12],[4922.98,4913.5,4928.3]],"source":"postgresql/results/m6i.8xlarge_bluesky_1000m.json"}
,{"system":"PostgreSQL","version":"16.6","os":"Ubuntu 24.04","date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"num_loaded_documents":91000000,"total_size":69064736768,"data_size":54598713344,"index_size":14465753088,"result":[[416.392,10.3372,10.3301],[1868.87,1458.26,1457.45],[440.283,33.0992,33.1468],[477.82,17.7637,17.3674],[476.837,18.9056,18.4372]],"source":"postgresql/results/m6i.8xlarge_bluesky_100m.json"}
,{"system":"PostgreSQL","version":"16.6","os":"Ubuntu 24.04","date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"num_loaded_documents":7000000,"total_size":5794693120,"data_size":4653178880,"index_size":1141514240,"result":[[35.1545,0.949281,0.949623],[51.8718,9.55589,9.57942],[36.1771,2.60652,2.59737],[175.424,1.99499,1.93142],[176.353,2.1341,2.11399]],"source":"postgresql/results/m6i.8xlarge_bluesky_10m.json"}
,{"system":"PostgreSQL","version":"16.6","os":"Ubuntu 24.04","date":"2025-01-13","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":731111424,"data_size":586768384,"index_size":144343040,"result":[[4.08449,0.133099,0.134603],[30.3611,2.15746,2.11889],[4.13365,0.35889,0.357372],[15.6849,0.487806,0.224725],[16.1242,0.251007,0.249576]],"source":"postgresql/results/m6i.8xlarge_bluesky_1m.json"}
,{"system":"SingleStore","version":"5.7.32","os":"Ubuntu 24.04","date":"2025-03-14","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"num_loaded_documents":811999990,"total_size":234878938296,"data_size":234878938296,"index_size":0,"result":[[51.599,43.98,51.557],[321.517,207.62,196.39],[125.113,113.956,111.105],[322.197,32.433,32.407],[326.151,40.692,40.644]],"memory_usage":[[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null]],"source":"singlestore/results/m6i.8xlarge_bluesky_1000m.json"}
,{"system":"SingleStore","version":"5.7.32","os":"Ubuntu 24.04","date":"2025-03-14","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"num_loaded_documents":91000000,"total_size":25757172429,"data_size":25757172429,"index_size":0,"result":[[6.471,5.066,5.606],[37.551,25.246,25.060],[14.634,12.810,12.786],[34.688,3.691,3.702],[34.735,4.934,4.713]],"memory_usage":[[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null]],"source":"singlestore/results/m6i.8xlarge_bluesky_100m.json"}
,{"system":"SingleStore","version":"5.7.32","os":"Ubuntu 24.04","date":"2025-03-14","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"num_loaded_documents":7000000,"total_size":1943790266,"data_size":1943790266,"index_size":0,"result":[[0.658,0.444,0.494],[2.831,2.647,2.836],[1.437,1.456,1.124],[1.253,0.412,0.434],[1.347,0.553,0.587]],"memory_usage":[[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null]],"source":"singlestore/results/m6i.8xlarge_bluesky_10m.json"}
,{"system":"SingleStore","version":"5.7.32","os":"Ubuntu 24.04","date":"2025-03-14","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":275466582,"data_size":275466582,"index_size":0,"result":[[0.206,0.083,0.098],[0.615,0.544,0.452],[0.366,0.268,0.149],[0.259,0.111,0.106],[0.324,0.167,0.171]],"memory_usage":[[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null]],"source":"singlestore/results/m6i.8xlarge_bluesky_1m.json"}
,{"system":"Starrocks","version":"4.0.1","os":"Ubuntu 24.04","date":"2025-11-17","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000000,"num_loaded_documents":997999662,"total_size":192981470543,"result":[[0.69,0.52,0.51],[74.01,7.27,7.18],[20.58,1.51,1.45],[15.86,1.03,1.01],[1.18,1.10,1.11]],"source":"starrocks/results/m6i.8xlarge_bluesky_1000m.json"}
,{"system":"Starrocks","version":"4.0.1","os":"Ubuntu 24.04","date":"2025-11-17","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":100000000,"num_loaded_documents":99999984,"total_size":18193481465,"result":[[0.17,0.09,0.09],[7.14,1.07,1.04],[1.13,0.21,0.22],[0.18,0.12,0.12],[0.19,0.13,0.14]],"source":"starrocks/results/m6i.8xlarge_bluesky_100m.json"}
,{"system":"Starrocks","version":"4.0.1","os":"Ubuntu 24.04","date":"2025-11-17","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":10000000,"num_loaded_documents":9999997,"total_size":2043330691,"result":[[0.09,0.03,0.03],[0.50,0.22,0.19],[0.12,0.06,0.05],[0.10,0.04,0.04],[0.10,0.04,0.04]],"source":"starrocks/results/m6i.8xlarge_bluesky_10m.json"}
,{"system":"Starrocks","version":"4.0.1","os":"Ubuntu 24.04","date":"2025-11-17","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"yes","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":207987146,"result":[[0.14,0.05,0.05],[0.21,0.06,0.06],[0.34,0.05,0.05],[0.11,0.03,0.03],[0.09,0.03,0.03]],"source":"starrocks/results/m6i.8xlarge_bluesky_1m.json"}
,{"system":"VictoriaLogs","version":"v1.17.0-victorialogs","os":"Ubuntu 24.04","date":"2025-03-28","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"no","tags":[],"dataset_size":1000000000,"num_loaded_documents":999999241,"total_size":121860870843,"data_size":108388327979,"index_size":13472542864,"result":[[1.076,0.029,0.028],[98.958,20.591,19.794],[14.423,1.607,1.609],[5.065,5.185,5.216],[7.22,6.963,7.351]],"source":"victorialogs/results/m6i.8xlarge_bluesky_1000m.json"}
,{"system":"VictoriaLogs","version":"v1.17.0-victorialogs","os":"Ubuntu 24.04","date":"2025-03-28","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"no","tags":[],"dataset_size":100000000,"num_loaded_documents":99999968,"total_size":11984344799,"data_size":10684518543,"index_size":1299826256,"result":[[0.097,0.009,0.009],[9.057,2.721,2.406],[0.474,0.151,0.148],[0.542,0.464,0.453],[0.735,0.623,0.664]],"source":"victorialogs/results/m6i.8xlarge_bluesky_100m.json"}
,{"system":"VictoriaLogs","version":"v1.17.0-victorialogs","os":"Ubuntu 24.04","date":"2025-03-28","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"no","tags":[],"dataset_size":10000000,"num_loaded_documents":9999994,"total_size":1242217952,"data_size":1108712800,"index_size":133505152,"result":[[0.086,0.007,0.007],[0.47,0.241,0.329],[0.095,0.027,0.028],[0.199,0.142,0.128],[0.211,0.148,0.176]],"source":"victorialogs/results/m6i.8xlarge_bluesky_10m.json"}
,{"system":"VictoriaLogs","version":"v1.17.0-victorialogs","os":"Ubuntu 24.04","date":"2025-03-28","machine":"m6i.8xlarge, 10000gib gp3","retains_structure":"no","tags":[],"dataset_size":1000000,"num_loaded_documents":1000000,"total_size":121728495,"data_size":108413431,"index_size":13315064,"result":[[0.074,0.006,0.006],[0.128,0.069,0.046],[0.082,0.015,0.015],[0.094,0.021,0.017],[0.126,0.052,0.056]],"source":"victorialogs/results/m6i.8xlarge_bluesky_1m.json"}
]; // end of data

    </script>
</head>
<body>

<div class="header stick-left">
    <span class="nowrap themes"><span id="toggle-dark">ðŸŒš</span><span id="toggle-light">ðŸŒž</span></span>
    <h1>JSONBench â€” a Benchmark For Data Analytics On JSON</h1>
    <a href="https://github.com/ClickHouse/JSONBench/">Methodology</a> | <a href="https://github.com/ClickHouse/JSONBench/">Reproduce and Validate the Results</a> | <a href="https://github.com/ClickHouse/JSONBench/">Add a System</a> | <a href="https://github.com/ClickHouse/JSONBench/">Report Mistake</a> | See also: <a href="https://benchmark.clickhouse.com/">ClickBench</a>
</div>

<table class="selectors-container stick-left">
    <tr>
        <th>System: </th>
        <td id="selectors_system">
            <a id="select-all-systems" class="selector selector-active">All</a>
        </td>
    </tr>
    <tr>
        <th>Scale: </th>
        <td id="selectors_scale">
        </td>
    </tr>
    <tr>
        <th>Metric: </th>
        <td id="selectors_run">
            <a class="selector" id="selector-metric-cold">Cold Run</a>
            <a class="selector" id="selector-metric-hot">Hot Run</a>
            <a class="selector" id="selector-metric-size">Storage Size</a>
            <a class="selector" id="selector-metric-quality">Data Quality</a>
        </td>
    </tr>
    <tr>
        <th>Flattening: </th>
        <td id="selectors_retain_structure">
            <a class="selector selector-active" id="selector-retain-structure-yes">No</a>
            <a class="selector" id="selector-retain-structure-no">Yes</a>
        </td>
    </tr>
</table>

<table class="stick-left comparison">
    <thead>
        <tr>
            <th class="summary-name">
                System
            </th>
            <th colspan="2">
                <span id="metric-title">Relative time (lower is better)</span>.<br/>
                <span id="scale_hint"></span>
            </th>
        </tr>
    </thead>
    <tbody id="summary">
    </tbody>
</table>

<div id="nothing-selected" class="stick-left">Nothing selected</div>

<div class="stick-left comparison">
    <h2>Detailed Comparison</h2>
</div>

<table id="details">
    <thead>
        <tr id="details_head">
        </tr>
    </thead>
    <tbody id="details_body">
    </tbody>
</table>

<script type="text/javascript">

const constant_time_add = 0.01;
const missing_result_penalty = 2;
const missing_result_time = 3600;

let selectors = {
    "system": {},
    "scale": 1000_000_000,
    "metric": "hot",
    "queries": [],
    "retain_structure": {"yes": true, "no": false}
};

let theme = 'light';

function setTheme(new_theme) {
    theme = new_theme;
    document.documentElement.setAttribute('data-theme', theme);
    window.localStorage.setItem('theme', theme);
    render();
}

document.getElementById('toggle-light').addEventListener('click', e => setTheme('light'));
document.getElementById('toggle-dark').addEventListener('click', e => setTheme('dark'));

let new_theme = window.localStorage.getItem('theme');
if (new_theme && new_theme != theme) {
    setTheme(new_theme);
}

/// Generate selectors

let systems = document.getElementById('selectors_system');
let scales = document.getElementById('selectors_scale');

let unique_systems = [... new Set(data.filter(elem => !elem.fake).map(elem => elem.system))];

function toggle(e, elem, selectors_map) {
    selectors_map[elem] = !selectors_map[elem];
    if (selectors_map[elem]) {
        e.target.classList.add('selector-active');
    } else {
        e.target.classList.remove('selector-active');
    }
    render();
    updateHistory();
}

function switchTo(e, selector) {
    [...e.target.parentElement.querySelectorAll('a')].map(elem => {
        elem.className = elem == e.target ? 'selector selector-active' : 'selector'
    });
    if (selector) selectors[selector] = e.target.dataset.value;
    render();
    updateHistory();
}

function toggleAll(e, selectors_map) {
    const new_value = Object.keys(selectors_map).filter(k => selectors_map[k]).length * 2 < Object.keys(selectors_map).length;
    [...e.target.parentElement.querySelectorAll('a')].map(
        elem => { elem.className = new_value ? 'selector selector-active' : 'selector' });

    Object.keys(selectors_map).map(k => { selectors_map[k] = new_value });
    render();
    updateHistory();
}

unique_systems.map(elem => {
    let selector = document.createElement('a');
    selector.classList.add('selector-active');
    selector.appendChild(document.createTextNode(elem));
    selector.dataset.name = elem;

    if (!elem.startsWith('_')) {
        systems.appendChild(selector);

        if (!(elem in selectors.system)) {
            selectors.system[elem] = data.some(entry => entry.system == elem && !entry.hide);
        }
        selector.addEventListener('click', e => toggle(e, elem, selectors.system));

        /// Highlighting summary rows and table columns on hovering over the system selector.
        selector.addEventListener('mouseover', e => {
            [...document.querySelectorAll('.summary-row')].map(row => {
                row.className = row.dataset.system == elem ? 'summary-row summary-row-hilite' : 'summary-row' });
            [...document.querySelectorAll('.th-entry')].map(th => {
                th.className = th.dataset.system == elem ? 'th-entry th-entry-hilite' : 'th-entry' });
        });
        selector.addEventListener('mouseout', e => {
            [...document.querySelectorAll('.summary-row')].map(row => { row.className = 'summary-row' });
            [...document.querySelectorAll('.th-entry')].map(row => { row.className = 'th-entry' });
        });
    }
});

[... new Set(data.map(elem => elem.dataset_size))].sort().map(elem => {
    let selector = document.createElement('a');
    selector.dataset.value = elem;
    const active = elem == (selectors.scale ?? 1_000_000_000);
    selector.classList.add('selector');
    if (active) {
        selectors.scale = elem;
        selector.classList.add('selector-active');
    }
    selector.appendChild(document.createTextNode((elem / 1_000_000) + " million"));
    scales.appendChild(selector);
    selector.addEventListener('click', e => { selectors.scale = elem; switchTo(e, 'scale') });
});

document.getElementById('select-all-systems').addEventListener('click', e => toggleAll(e, selectors.system));

[...document.getElementById('selectors_run').querySelectorAll('a')].map(elem => elem.addEventListener('click', e => switchTo(e)));

document.getElementById('selector-metric-cold').addEventListener('click', e => { selectors.metric = 'cold'; render(); updateHistory(); });
document.getElementById('selector-metric-hot').addEventListener('click', e => { selectors.metric = 'hot'; render(); updateHistory(); });
document.getElementById('selector-metric-size').addEventListener('click', e => { selectors.metric = 'size'; render(); updateHistory(); });
document.getElementById('selector-metric-quality').addEventListener('click', e => { selectors.metric = 'quality'; render(); updateHistory(); });

document.getElementById('selector-retain-structure-yes').addEventListener('click', e => {
    selectors.retain_structure.yes = !selectors.retain_structure.yes;
    if (selectors.retain_structure.yes) {
        e.target.classList.add('selector-active');
    } else {
        e.target.classList.remove('selector-active');
    }
    render();
    updateHistory();
});
document.getElementById('selector-retain-structure-no').addEventListener('click', e => {
    selectors.retain_structure.no = !selectors.retain_structure.no;
    if (selectors.retain_structure.no) {
        e.target.classList.add('selector-active');
    } else {
        e.target.classList.remove('selector-active');
    }
    render();
    updateHistory();
});

selectors.queries = queries.map(() => true);

function updateSelectors() {
    [...systems.childNodes].filter(elem => elem.tagName == 'A').map(elem => {
        elem.className = selectors.system[elem.dataset.name] ? 'selector selector-active' : 'selector' });
    [...scales.childNodes].filter(elem => elem.tagName == 'A').map(elem => { elem.className = (selectors.scale == elem.dataset.value) ? 'selector selector-active' : 'selector' });

    [...document.getElementById('selectors_run').querySelectorAll('a')].map(elem => {
        elem.className = elem.id == 'selector-metric-' + selectors.metric ? 'selector selector-active' : 'selector' });

    // Update retain structure buttons state
    document.getElementById('selector-retain-structure-yes').className =
        selectors.retain_structure.yes ? 'selector selector-active' : 'selector';
    document.getElementById('selector-retain-structure-no').className =
        selectors.retain_structure.no ? 'selector selector-active' : 'selector';

    [...document.querySelectorAll('.query-checkbox')].map((elem, i) => { elem.checked = selectors.queries[i] });
}

function clearElement(elem)
{
    while (elem.firstChild) {
        elem.removeChild(elem.lastChild);
    }
}

function selectRun(timings) {
    return selectors.metric == 'cold' ? timings[0] : (timings[1] !== null && timings[2] !== null ? Math.min(timings[1], timings[2]) : null)
}

function addNote(text) {
    let note = document.createElement('sup');
    note.className = 'note';
    note.appendChild(document.createTextNode('â€ '));

    let tooltip = document.createElement('span');
    tooltip.className = 'tooltip tooltip-result';
    tooltip.appendChild(document.createTextNode(text));

    note.appendChild(tooltip);
    return note;
}

function renderSummary(filtered_data) {
    let table = document.getElementById('summary');
    clearElement(table);

    /// Generate summary

    /// The algorithm: for each of the queries,
    /// - if there is a result - take query duration, add 10 ms, and divide it to the corresponding value from the baseline,
    /// - if there is no result - take the worse query duration across all query runs for this system and multiply by 2.
    /// Take geometric mean across the queries.

    let summary = {};

    const num_queries = queries.length;

    const baseline_data = [...queries.keys()].map(query_num =>
        [...Array(3).keys()].map(run_num =>
            Math.min(...filtered_data.filter(elem => !elem.fake && elem.result.length > 0).map(elem => elem.result[query_num][run_num]).filter(x => x != null))));

    const min_load_time = Math.min(...filtered_data.map(elem => elem.load_time).filter(x => x));
    const min_data_size = Math.min(...filtered_data.map(elem => elem.total_size).filter(x => x));

    let summaries;
    if (selectors.metric == 'quality') {
        summaries = filtered_data.map(elem => 1 - elem.num_loaded_documents / selectors.scale);
        document.getElementById('metric-title').innerText = 'Data quality (higher is better)';
    } else if (selectors.metric == 'size') {
        summaries = filtered_data.map(elem => elem.total_size / min_data_size);
        document.getElementById('metric-title').innerText = 'Storage size (lower is better)';
    } else {
        summaries = filtered_data.map(elem => {
            let accumulator = 0;
            let used_queries = 0;

            const no_queries_selected = selectors.queries.filter(x => x).length == 0;

            for (let i = 0; i < num_queries; ++i) {
                if (no_queries_selected || selectors.queries[i]) {
                    const fallback_timing = missing_result_penalty * Math.max(missing_result_time, ...filtered_data.filter(other => other.result.length > i).map(other => selectRun(other.result[i])));

                    const curr_timing = elem.fake || elem.result.length <= i ? fallback_timing : selectRun(elem.result[i]) ?? fallback_timing;
                    const baseline_timing = selectRun(baseline_data[i]);
                    const ratio = (constant_time_add + curr_timing) / (constant_time_add + baseline_timing);
                    accumulator += Math.log(ratio);
                    ++used_queries;
                }
            }

            return Math.exp(accumulator / used_queries);
        });
        document.getElementById('metric-title').innerText = 'Relative time (lower is better)';
    }

    const sorted_indices = [...summaries.keys()].sort((a, b) => summaries[a] - summaries[b]);
    const max_ratio = summaries[sorted_indices[sorted_indices.length - 1]];

    sorted_indices.map(idx => {
        const elem = filtered_data[idx];

        if (selectors.metric == 'size' && elem.total_size === null) { return; }
        if (selectors.metric != 'size' && elem.fake) { return; }

        let tr = document.createElement('tr');
        tr.className = 'summary-row';

        tr.dataset.system = elem.system;

        let td_name = document.createElement('td');
        td_name.className = 'summary-name';

        let link = document.createElement('a');
        link.appendChild(document.createTextNode(`${elem.system}`));
        link.href = "https://github.com/ClickHouse/JSONBench/blob/main/" + elem.source;
        td_name.appendChild(link);

        if (elem.comment) { td_name.appendChild(addNote(elem.comment)); }
        td_name.appendChild(document.createTextNode(': '));

        const ratio = summaries[idx];
        const percentage = (selectors.metric == 'quality' ? 1 - summaries[idx] : summaries[idx] / max_ratio) * 100;

        let td_number = document.createElement('td');
        td_number.className = 'summary-number';

        let text;
        if (selectors.metric == 'load') {
            text = (elem.load_time ? `${Math.round(elem.load_time)}s (Ã—${ratio.toFixed(2)})` : 'stateless');
        } else if (selectors.metric == 'size') {
            text = `${(elem.total_size / 1024 / 1024 / 1024).toFixed(2)} GiB (Ã—${ratio.toFixed(2)})`;
        } else if (selectors.metric == 'quality') {
            text = `${Number(100 * elem.num_loaded_documents / selectors.scale).toFixed(2)}%`
        } else {
            text = `Ã—${ratio.toFixed(2)}`;
        }

        td_number.appendChild(document.createTextNode(text));

        let td_bar = document.createElement('td');
        td_bar.className = 'summary-bar-cell';

        let bar = document.createElement('div');

        bar.className = elem.fake ? `summary-bar-fake` : `summary-bar`;
        if (elem.fake) {
            bar.style.width = `${percentage}%`;
        } else {
            bar.style.background = `linear-gradient(to right,
                var(--bar-color1) 0%,
                var(--bar-color1) ${Math.min(100, percentage)}%,
                var(--bar-color2) ${Math.min(100, percentage)}%,
                var(--bar-color2) ${Math.min(100, percentage * 10)}%,
                var(--bar-color3) ${Math.min(100, percentage * 10)}%,
                var(--bar-color3) ${Math.min(100, percentage * 100)}%,
                var(--bar-color4) ${Math.min(100, percentage * 100)}%,
                var(--bar-color4) ${Math.min(100, percentage * 1000)}%,
                transparent ${Math.min(100, percentage * 1000)}%,
                transparent 100%)`;
        }

        td_bar.appendChild(bar);

        tr.appendChild(td_name);
        tr.appendChild(td_bar);
        tr.appendChild(td_number);
        table.appendChild(tr);
    });

    return [sorted_indices, baseline_data];
}

function colorize(elem, ratio) {
    let [r, g, b] = [0, 0, 0];

    /// ratio less than 1 - green
    /// ratio from 1 to 2 - green to yellow
    /// ratio from 2 to 10 - yellow to red
    /// ratio from 10 to 1000 to infinity - red to brown to black

    /// Note: we are using RGB space without proper gamma correction. Read more: https://www.handprint.com/HP/WCL/color1.html

    if (ratio !== null) {
        if (ratio < 1) {
            r = 232;
            g = 255;
            b = 232;
        } else if (ratio <= 1) {
            g = 255;
        } else if (ratio <= 2) {
            g = 255;
            r = (ratio - 1) * 255;
        } else if (ratio <= 10) {
            g = (10 - ratio) / 8 * 255;
            r = 255;
        } else {
            r = (1 - ((ratio - 10) / ((ratio - 10) + 1000))) * 255;
        }
    }

    if (document.documentElement.getAttribute('data-theme') == 'dark') {
        r /= 1.5;
        g /= 1.5;
        b /= 1.5;
    }

    elem.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
    if (ratio === null || ratio > 10) {
        /// This will look better on dark backgrounds
        elem.style.color = 'white';
    } else {
        elem.style.color = 'black';
    }

    /// The best result is highlighted
    if (ratio == 1) {
        elem.style.fontWeight = 'bold';
    }
}

function render() {
    let details_head = document.getElementById('details_head');
    let details_body = document.getElementById('details_body');

    clearElement(details_head);
    clearElement(details_body);

    let filtered_data = data.filter(elem =>
        (selectors.system[elem.system] || (selectors.metric == 'size' && elem.fake)) &&
        selectors.scale == elem.dataset_size &&
        (
            (selectors.retain_structure.yes && elem.retains_structure === "yes") ||
            (selectors.retain_structure.no && elem.retains_structure === "no")
        ));

    let nothing_selected_elem = document.getElementById('nothing-selected');
    if (filtered_data.length == 0) {
        nothing_selected_elem.style.display = 'block';
        [...document.querySelectorAll('.comparison')].map(e => e.style.display = 'none');
        return;
    }
    nothing_selected_elem.style.display = 'none';
    [...document.querySelectorAll('.comparison')].map(e => e.style.display = 'block');

    let [sorted_indices, baseline_data] = renderSummary(filtered_data);
    sorted_indices = sorted_indices.filter(idx => !filtered_data[idx].fake);

    /// Generate details

    /// Global checkbox
    {
        let th_checkbox = document.createElement('th');
        let checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = true;
        checkbox.addEventListener('change', e => {
            [...document.querySelectorAll('.query-checkbox')].map(elem => { elem.checked = e.target.checked });
            selectors.queries.map((_, i) => { selectors.queries[i] = e.target.checked });
            renderSummary(filtered_data);
            updateHistory();
        });
        th_checkbox.appendChild(checkbox);
        details_head.appendChild(th_checkbox);
        details_head.appendChild(document.createElement('th'));
    }

    /// Table header
    sorted_indices.map(idx => {
        const elem = filtered_data[idx];
        let th = document.createElement('th');
        th.appendChild(document.createTextNode(`${elem.system}`));
        th.className = 'th-entry';
        th.dataset.system = elem.system;
        details_head.appendChild(th);
    });

    /// Data sizes
    {
        let tr = document.createElement('tr');
        tr.className = 'shadow';

        let td_title = document.createElement('td');
        td_title.colSpan = 2;
        td_title.appendChild(document.createTextNode('Data size: '));
        tr.appendChild(td_title);

        sorted_indices.map(idx => {
            const curr_size = filtered_data[idx].total_size;
            const baseline_size = Math.min(...filtered_data.map(elem => elem.total_size).filter(x => x));
            const ratio = curr_size !== null ? curr_size / baseline_size : null;

            let td = document.createElement('td');
            td.appendChild(document.createTextNode(curr_size !== null ? `${(curr_size / 1024 / 1024 / 1024).toFixed(2)} GiB (Ã—${ratio.toFixed(2)})` : 'â˜ '));

            colorize(td, ratio);
            tr.appendChild(td);
        });

        details_body.appendChild(tr);
    }

    /// Data Quality
    {
        let tr = document.createElement('tr');
        tr.className = 'shadow';

        let td_title = document.createElement('td');
        td_title.colSpan = 2;
        td_title.appendChild(document.createTextNode('Data quality: '));
        tr.appendChild(td_title);

        sorted_indices.map(idx => {
            const curr_size = filtered_data[idx].num_loaded_documents;
            const ratio = 1 + 1000 * (1 - curr_size / selectors.scale);

            let td = document.createElement('td');
            td.appendChild(document.createTextNode(curr_size));

            colorize(td, ratio);
            tr.appendChild(td);
        });

        details_body.appendChild(tr);
    }

    /// Query runtimes
    const num_queries = queries.length;

    for (let query_num = 0; query_num < num_queries; ++query_num) {
        let tr = document.createElement('tr');
        tr.className = 'shadow';

        let td_checkbox = document.createElement('td');
        let checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'query-checkbox';
        checkbox.checked = selectors.queries[query_num];
        checkbox.addEventListener('change', e => {
            selectors.queries[query_num] = e.target.checked;
            renderSummary(filtered_data);
            updateHistory();
        });
        td_checkbox.appendChild(checkbox);
        tr.appendChild(td_checkbox);

        let td_query_num = document.createElement('td');
        td_query_num.className = 'note';
        td_query_num.appendChild(document.createTextNode(`Q${1 + query_num}. `));

        let tooltip = document.createElement('span');
        tooltip.className = 'tooltip tooltip-query';
        tooltip.appendChild(document.createTextNode(`Query ${1 + query_num}: ${queries[query_num]}`));
        td_query_num.appendChild(tooltip);

        tr.appendChild(td_query_num);

        sorted_indices.map(idx => {
            const curr_timing = filtered_data[idx].result.length > 0 ? selectRun(filtered_data[idx].result[query_num]) : null;
            const baseline_timing = selectRun(baseline_data[query_num]);
            const ratio = curr_timing !== null ? (constant_time_add + curr_timing) / (constant_time_add + baseline_timing) : null;

            let td = document.createElement('td');
            td.appendChild(document.createTextNode(curr_timing !== null ? `${curr_timing.toFixed(3)}s (Ã—${ratio.toFixed(2)})` : 'â˜ '));

            colorize(td, ratio);
            tr.appendChild(td);
        });

        details_body.appendChild(tr);
    }

    /// The small hint below column heading "Relative time (lower is better)"
    document.getElementById("scale_hint").textContent = 'Different colors on the bar chart represent the same values shown at different scales (1x, 10x, 100x zoom)';
}

function updateHistory() {
    history.pushState(selectors, '',
        window.location.pathname + (window.location.search || '') + '#' + btoa(JSON.stringify(selectors)));
}

window.onpopstate = function(event) {
    if (!event.state) { return; }
    selectors = event.state;
    // Ensure retain_structure exists in loaded state
    if (!selectors.retain_structure) {
        selectors.retain_structure = {"yes": true, "no": false};
    }
    render();
    updateSelectors();
};

if (window.location.hash) {
    try {
        selectors = JSON.parse(atob(window.location.hash.substring(1)));
        // Ensure retain_structure exists in loaded state
        if (!selectors.retain_structure) {
            selectors.retain_structure = {"yes": true, "no": false};
        }
    } catch {}
}

render();
updateSelectors();

</script>
</body>
</html>
