# Vector Component

## Назначение

Компонент `vector` реализует векторизованную обработку данных с колоночными векторами, обеспечивая эффективные batch-операции.

## Основные файлы

- `vector.hpp/cpp` - Основной класс вектора
- `data_chunk.hpp/cpp` - Пакет векторов (строковый блок)
- `vector_buffer.hpp/cpp` - Управление буферами памяти
- `vector_operations.hpp/cpp` - Векторизованные операции
- `indexing_vector.hpp/cpp` - Индексные векторы для индирекции
- `validation.hpp/cpp` - Валидация данных (NULL маски)

## Ключевые классы и функциональность

### Основные классы

- **`vector_t`** - Колоночный вектор для одной колонки:
  - Хранит данные одного типа
  - Поддерживает различные физические форматы
  - Управление NULL значениями

### Типы векторов

- **`FLAT`** - Плоский массив значений:
  - Стандартное представление
  - Прямой доступ к элементам
  - Наиболее эффективный для большинства операций

- **`CONSTANT`** - Константный вектор:
  - Все элементы имеют одно значение
  - Экономит память
  - Используется для литералов

- **`DICTIONARY`** - Словарное кодирование:
  - Индексы в словарь уникальных значений
  - Эффективно для данных с низкой кардинальностью
  - Компактное представление повторяющихся значений

- **`SEQUENCE`** - Последовательность:
  - Арифметическая прогрессия
  - Хранит только начало и шаг
  - Используется для генерации индексов

### Data Chunk

- **`data_chunk_t`** - Пакет векторов, формирующий блок строк:
  - Фиксированное количество строк (обычно до 2048)
  - Несколько колонок-векторов
  - Единица передачи данных между операторами

### Управление памятью

- **`vector_buffer_t`** - Буфер памяти для вектора:
  - Управление жизненным циклом памяти
  - Shared ownership (подсчет ссылок)
  - Эффективное переиспользование

### Validity Mask

- **`validity_mask_t`** - Отслеживание NULL значений:
  - Битовая маска для эффективного хранения
  - Быстрая проверка NULL
  - Компактное представление

### Индексные векторы

- **`indexing_vector_t`** - Вектор индексов для индирекции:
  - Перенаправление доступа к элементам
  - Используется для фильтрации и переупорядочивания
  - Избегает копирования данных

### Векторизованные операции

- **`vector_operations`** - Интерфейс для операций над векторами:
  - Арифметические операции
  - Логические операции
  - Операции сравнения
  - Агрегатные функции

**Операции над векторами:**
- **slice** - извлечение подмножества элементов
- **flatten** - преобразование в FLAT формат
- **append** - добавление элементов
- **reference** - создание ссылки на вектор
- **copy** - глубокое копирование

### Unified Format

Преобразование различных форматов векторов в единый формат для обработки:
- Упрощает реализацию операций
- Позволяет работать с любым типом вектора единообразно
- Автоматическая материализация при необходимости

### Поддержка вложенных типов

- **Lists** - списки переменной длины:
  - Offset вектор для границ списков
  - Child вектор для элементов

- **Structs** - структуры:
  - Вектор для каждого поля
  - Согласованные validity маски

- **Arrays** - массивы фиксированной длины:
  - Child вектор для всех элементов
  - Фиксированный размер на элемент

## Использование

Векторы используются для эффективной обработки данных в batch-режиме:

```cpp
// Создание вектора
vector_t vec(logical_type::INTEGER, 1024); // 1024 элемента

// Создание data chunk
data_chunk_t chunk;
chunk.add_column(std::move(vec1));
chunk.add_column(std::move(vec2));
chunk.set_cardinality(1000); // 1000 строк

// Векторизованные операции
vector_operations::add(result_vec, vec1, vec2);
vector_operations::filter(filtered_vec, vec, predicate);
```

### Преимущества векторизации

1. **Производительность**:
   - Batch-обработка минимизирует overhead
   - SIMD оптимизации на уровне CPU
   - Лучшая утилизация кеша

2. **Эффективность памяти**:
   - Колоночный формат
   - Специализированные представления (CONSTANT, SEQUENCE)
   - Словарное кодирование

3. **Упрощение кода**:
   - Единообразный интерфейс для операций
   - Автоматическая обработка NULL значений
   - Unified format для упрощения реализации

### Архитектурные особенности

- **Columnar processing** - обработка колонок, а не строк
- **Vectorized execution** - операции над блоками данных
- **Late materialization** - отложенное вычисление
- **Dictionary encoding** - компрессия для low-cardinality данных
- **SIMD-friendly** - оптимизация для векторных инструкций CPU
