# Table Component

## Назначение

Компонент `table` реализует колоночное хранилище табличных данных с поддержкой MVCC, компрессии и эффективного сканирования.

## Основные файлы

### Управление таблицами
- `data_table.hpp/cpp` - Основной класс хранилища таблицы
- `collection.hpp/cpp` - Менеджер коллекции row groups
- `table_state.hpp/cpp` - Управление состоянием операций таблицы

### Row Groups и колонки
- `row_group.hpp/cpp` - Группы строк фиксированного размера
- `column_data.hpp/cpp` - Базовое хранилище колонки
- `column_segment.hpp/cpp` - Сегменты данных колонок
- `column_state.hpp/cpp` - Состояние операций над колонками
- `column_definition.hpp/cpp` - Определения колонок

### Типы колонок
- `standard_column_data.hpp/cpp` - Стандартные примитивные типы
- `struct_column_data.hpp/cpp` - Структурированные типы
- `array_column_data.hpp/cpp` - Массивы фиксированного размера
- `list_column_data.hpp/cpp` - Списки переменной длины
- `validity_column_data.hpp/cpp` - Отслеживание NULL значений

### MVCC и версионирование
- `update_segment.hpp/cpp` - Сегменты обновлений
- `row_version_manager.hpp/cpp` - Управление версиями строк для MVCC

### Вспомогательные структуры
- `segment_tree.hpp` - Деревья сегментов для эффективных запросов

## Ключевые классы и функциональность

### Основные классы

- **`data_table_t`** - Главный класс хранилища таблицы:
  - Управление row groups
  - CRUD операции (create, read, update, delete)
  - Сканирование данных
  - Управление колонками

- **`collection_t`** - Менеджер коллекции row groups:
  - Организация данных в фиксированные блоки
  - Параллельное сканирование
  - Оптимизация размещения данных

- **`row_group_t`** - Группа строк для колоночного хранения:
  - Фиксированный размер (обычно 122,880 строк)
  - Колоночная организация внутри группы
  - Метаданные для пропуска блоков (min/max статистики)

### Типы колонок

**Базовый класс:**
- **`column_data`** - Базовое хранилище колонки с общим интерфейсом

**Специализированные типы:**
- **`standard_column_data`** - Примитивные типы (int, float, double, string)
- **`struct_column_data`** - Вложенные структуры с именованными полями
- **`array_column_data`** - Массивы фиксированной длины
- **`list_column_data`** - Списки переменной длины (векторы)
- **`validity_column_data`** - Битовая маска для NULL значений

### Сегменты колонок

- **`column_segment`** - Сегменты данных колонок:
  - Компрессия данных
  - Ленивая загрузка
  - Статистики для оптимизации

### MVCC поддержка

- **`row_version_manager`** - Управление версиями строк:
  - Отслеживание версий для изоляции транзакций
  - Garbage collection старых версий
  - Snapshot isolation

- **`update_segment`** - Хранение обновлений:
  - Дельта-сжатие изменений
  - Эффективное хранение обновлений
  - Слияние с основными данными

### Операции с таблицами

**Операции чтения:**
- **scan** - последовательное сканирование
- **fetch** - прямой доступ по row ID
- **multi-threaded scan** - параллельное сканирование

**Операции записи:**
- **append** - добавление новых строк
- **update** - обновление существующих строк
- **delete** - удаление строк (логическое)

**Операции с колонками:**
- **add_column** - добавление новой колонки
- **remove_column** - удаление колонки
- **alter_type** - изменение типа колонки

### Управление состоянием

- **`table_state`** - Управление состоянием операций:
  - Отслеживание блокировок
  - Управление версиями
  - Координация параллельных операций

- **`column_state`** - Состояние операций над колонками:
  - Сканирование
  - Обновление
  - Сжатие

## Использование

Таблицы используются для хранения реляционных данных с поддержкой SQL:

```cpp
// Создание таблицы
auto table = std::make_unique<data_table_t>(table_id, schema);

// Вставка данных
table->append(data_chunk);

// Сканирование
table->scan(context, scan_state, result_chunk);

// Обновление
table->update(context, row_ids, updates);
```

### Преимущества колоночного хранилища

1. **Эффективная компрессия** - однородные данные лучше сжимаются
2. **Быстрая аналитика** - чтение только нужных колонок
3. **Векторизация** - batch-обработка данных
4. **SIMD оптимизации** - параллельная обработка на уровне CPU
5. **Пропуск блоков** - использование статистик для фильтрации

### Архитектурные особенности

- **Columnar layout** - данные организованы по колонкам, не по строкам
- **Row groups** - фиксированные блоки для баланса между размером и гибкостью
- **MVCC** - поддержка изоляции транзакций без блокировок
- **Compression** - встроенная компрессия данных
- **Statistics** - min/max значения для каждого сегмента
