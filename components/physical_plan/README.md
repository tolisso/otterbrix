# Physical Plan Component

## Назначение

Компонент `physical_plan` реализует операторы физического плана выполнения, которые непосредственно выполняют запросы на данных.

## Структура директорий

```
physical_plan/
├── base/             # Базовые операторы для всех типов хранилищ
├── collection/       # Операторы для документного хранилища
└── table/           # Операторы для колоночного хранилища
```

## Основные файлы

### Базовые операторы (base/)

**Основные классы:**
- `operator.hpp/cpp` - Базовый класс оператора
- `operator_data.hpp/cpp` - Оператор чтения данных
- `operator_write_data.hpp/cpp` - Оператор записи данных
- `operator_empty.hpp/cpp` - Пустой оператор
- `operator_raw_data.hpp/cpp` - Оператор для сырых данных
- `operator_add_index.hpp/cpp` - Создание индекса
- `operator_drop_index.hpp/cpp` - Удаление индекса

### Операторы для коллекций (collection/)

**Основные операторы:**
- `operator_match.hpp/cpp` - Фильтрация документов
- `operator_insert.hpp/cpp` - Вставка документов
- `operator_delete.hpp/cpp` - Удаление документов
- `operator_update.hpp/cpp` - Обновление документов
- `operator_sort.hpp/cpp` - Сортировка результатов
- `operator_join.hpp/cpp` - Соединение коллекций
- `operator_group.hpp/cpp` - Группировка данных
- `aggregation.hpp/cpp` - Агрегатные функции

**Подоператоры сканирования:**
- `full_scan` - Полное сканирование коллекции
- `index_scan` - Сканирование с использованием индекса
- `primary_key_scan` - Сканирование по первичному ключу
- `transfer_scan` - Передача данных из другого оператора

**Подоператоры слияния:**
- `operator_and` - Логическое И (пересечение)
- `operator_or` - Логическое ИЛИ (объединение)
- `operator_not` - Логическое НЕ (отрицание)
- `operator_merge` - Общее слияние

**Подоператоры агрегации:**
- `operator_sum` - Суммирование
- `operator_avg` - Среднее значение
- `operator_count` - Подсчет элементов
- `operator_min` - Минимальное значение
- `operator_max` - Максимальное значение

**Подоператоры извлечения:**
- `operator_get` - Извлечение значения поля
- `simple_value` - Простое значение

**Подоператоры фильтрации:**
- `predicate` - Комплексный предикат
- `simple_predicate` - Простой предикат

### Операторы для таблиц (table/)

Аналогичная структура операторов, но оптимизированная для колоночного хранилища:
- Векторизованная обработка данных
- Batch-операции
- `transformation.hpp` - Преобразования для таблиц

## Ключевые классы и функциональность

### Базовый класс оператора

- **`operator_t`** - Базовый класс оператора:
  - **Машина состояний**:
    - `created` - создан
    - `running` - выполняется
    - `waiting` - ожидает
    - `executed` - выполнен
    - `cleared` - очищен
  - **Типы операторов**:
    - Read-only - только чтение
    - Read-write - чтение и запись

### Стратегии сканирования

1. **Full scan** - последовательное сканирование всех данных
2. **Index scan** - использование индекса для быстрого поиска
3. **Primary key scan** - прямой доступ по первичному ключу

### Операторы слияния

Используются для комбинирования результатов нескольких сканирований:
- **AND** - пересечение множеств
- **OR** - объединение множеств
- **NOT** - дополнение множества

## Использование

Физический план создается генератором физического плана из логического плана. Операторы выполняются в порядке, определенном деревом операторов:

1. Операторы выполняются сверху вниз
2. Каждый оператор получает данные от дочерних операторов
3. Результат передается родительскому оператору
4. Корневой оператор возвращает результат пользователю

Система поддерживает два типа хранилища:
- **collection** - для документо-ориентированных данных
- **table** - для реляционных данных с колоночным хранением
