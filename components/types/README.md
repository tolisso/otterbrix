# Types Component

## Назначение

Компонент `types` определяет систему типов с физическими и логическими типами, поддерживая примитивные типы, вложенные структуры и преобразования типов.

## Основные файлы

- `types.hpp/cpp` - Определения типов системы
- `logical_value.hpp/cpp` - Логическое представление значений
- `physical_value.hpp/cpp` - Физическое хранение значений
- `operations_helper.hpp` - Вспомогательные операции над типами

## Ключевые перечисления и классы

### Физические типы

- **`physical_type`** - Низкоуровневые типы хранения:

**Булевы:**
- `BOOL` - логический тип

**Целочисленные (signed):**
- `INT8` - 8-бит (char)
- `INT16` - 16-бит (short)
- `INT32` - 32-бит (int)
- `INT64` - 64-бит (long)
- `INT128` - 128-бит (очень большие целые)

**Целочисленные (unsigned):**
- `UINT8` - 8-бит (unsigned char)
- `UINT16` - 16-бит (unsigned short)
- `UINT32` - 32-бит (unsigned int)
- `UINT64` - 64-бит (unsigned long)
- `UINT128` - 128-бит

**Числа с плавающей точкой:**
- `FLOAT` - 32-бит (float)
- `DOUBLE` - 64-бит (double)

**Строки и данные:**
- `STRING` - строковый тип
- `VARCHAR` - строка переменной длины
- `INTERVAL` - временной интервал

**Составные типы:**
- `LIST` - список переменной длины
- `STRUCT` - структура с именованными полями
- `ARRAY` - массив фиксированной длины

**Специальные:**
- `INVALID` - недействительный тип

### Логические типы

- **`logical_type`** - Высокоуровневые семантические типы:

**Базовые:**
- `BOOLEAN` - логический
- `TINYINT`, `SMALLINT`, `INTEGER`, `BIGINT`, `HUGEINT` - целочисленные
- `UTINYINT`, `USMALLINT`, `UINTEGER`, `UBIGINT`, `UHUGEINT` - беззнаковые целочисленные
- `FLOAT`, `DOUBLE` - числа с плавающей точкой
- `DECIMAL` - десятичный тип с фиксированной точностью

**Временные:**
- `TIMESTAMP` - временная метка (микросекунды по умолчанию)
- `TIMESTAMP_MS` - миллисекунды
- `TIMESTAMP_NS` - наносекунды
- `TIMESTAMP_S` - секунды
- `TIMESTAMP_TZ` - с часовым поясом
- `DATE` - дата
- `TIME` - время
- `TIME_TZ` - время с часовым поясом
- `INTERVAL` - временной интервал

**Строковые:**
- `STRING_LITERAL` - строковый литерал
- `VARCHAR` - строка переменной длины

**Составные:**
- `STRUCT` - структура (именованные поля)
- `LIST` - список переменной длины
- `MAP` - ключ-значение отображение
- `ARRAY` - массив фиксированной длины
- `UNION` - объединение типов

**Специальные:**
- `ENUM` - перечисление
- `AGGREGATE_STATE` - состояние агрегации
- `LAMBDA` - лямбда-функция
- `ANY` - любой тип
- `INVALID` - недействительный тип

### Сложные логические типы

- **`complex_logical_type`** - Дескриптор типа с расширениями для вложенных типов

**Расширения типов:**

- **`array_logical_type_extension`** - Массивы фиксированного размера:
  - Тип элементов
  - Размер массива

- **`list_logical_type_extension`** - Списки переменной длины:
  - Тип элементов

- **`struct_logical_type_extension`** - Структурированные типы:
  - Именованные поля
  - Типы полей

- **`map_logical_type_extension`** - Отображения ключ-значение:
  - Тип ключа
  - Тип значения

- **`decimal_logical_type_extension`** - Десятичные типы:
  - Точность (precision)
  - Масштаб (scale)

- **`enum_logical_type_extension`** - Перечисления:
  - Список возможных значений

### Значения

- **`logical_value_t`** - Представление значения во время выполнения:
  - Хранит тип и значение
  - Поддержка всех логических типов
  - Преобразование между типами

- **`physical_value_t`** - Физическое хранение значения:
  - Оптимизированное представление для хранения
  - Компактное представление

### Операции

- **Продвижение типов** (type promotion):
  - Автоматическое приведение типов в выражениях
  - Правила совместимости типов

- **Преобразование типов** (type conversion):
  - Явное приведение (CAST)
  - Неявное приведение

- **Сравнение**:
  - `compare_t` enum: LESS_THAN, EQUAL, GREATER_THAN
  - Операции сравнения с учетом типов

## Использование

Система типов используется во всех компонентах:

```cpp
// Определение колонки
complex_logical_type int_type(logical_type::INTEGER);
complex_logical_type string_type(logical_type::VARCHAR);

// Массив целых чисел
auto array_ext = std::make_shared<array_logical_type_extension>(
    int_type, 10);
complex_logical_type array_type(logical_type::ARRAY, array_ext);

// Структура
std::vector<std::pair<std::string, complex_logical_type>> fields = {
    {"id", int_type},
    {"name", string_type}
};
auto struct_ext = std::make_shared<struct_logical_type_extension>(fields);
complex_logical_type struct_type(logical_type::STRUCT, struct_ext);

// Значения
logical_value_t int_val(42, int_type);
logical_value_t str_val("hello", string_type);
```

### Важные особенности

1. **Разделение физических и логических типов**:
   - Физические типы - для хранения и производительности
   - Логические типы - для семантики и пользовательского интерфейса

2. **Поддержка вложенных типов**:
   - Структуры в структурах
   - Списки списков
   - Массивы структур

3. **Типобезопасность**:
   - Проверка типов на этапе компиляции и выполнения
   - Явные преобразования для предотвращения потери данных

4. **Оптимизация**:
   - Компактное представление физических значений
   - Эффективные операции сравнения и преобразования
