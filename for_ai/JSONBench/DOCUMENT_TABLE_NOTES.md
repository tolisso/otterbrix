# Document Table –¥–ª—è JSONBench

## –í–∞–∂–Ω–æ: Otterbrix –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∏–ø JSON!

–í–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å –∫–æ–ª–æ–Ω–∫–æ–π —Ç–∏–ø–∞ `JSON` (–∫–∞–∫ –≤ DuckDB, PostgreSQL, ClickHouse), Otterbrix –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π **document_table** storage.

## –ß—Ç–æ —Ç–∞–∫–æ–µ document_table?

**Document Table Storage** - —ç—Ç–æ –≥–∏–±—Ä–∏–¥–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ Otterbrix:
- –•—Ä–∞–Ω–∏—Ç JSON –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –∫–æ–ª–æ–Ω–æ—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç JSON paths –∏ —Å–æ–∑–¥–∞–µ—Ç –∫–æ–ª–æ–Ω–∫–∏
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—à–∏—Ä—è–µ—Ç —Å—Ö–µ–º—É –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–ª–æ–Ω–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å –≥–∏–±–∫–æ—Å—Ç—å—é –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è –æ—Ç JSON –∫–æ–ª–æ–Ω–∫–∏

### –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (DuckDB, PostgreSQL)
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å JSON –∫–æ–ª–æ–Ω–∫–æ–π
CREATE TABLE bluesky (j JSON);

-- –í—Å—Ç–∞–≤–∫–∞
INSERT INTO bluesky VALUES ('{"did": "...", "kind": "commit"}');

-- –ó–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ JSON –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
SELECT j->>'$.did', j->>'$.kind' FROM bluesky;
```

### Otterbrix document_table
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ document_table
CREATE TABLE bluesky() WITH (storage='document_table');

-- –í—Å—Ç–∞–≤–∫–∞ (—Å—Ö–µ–º–∞ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!)
INSERT INTO bluesky VALUES ('{"did": "...", "kind": "commit"}');

-- –°—Ö–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç: [_id, did, kind]
-- –ó–∞–ø—Ä–æ—Å—ã –Ω–∞–ø—Ä—è–º—É—é –∫ –∫–æ–ª–æ–Ω–∫–∞–º (–±–µ–∑ JSON –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤!)
SELECT did, kind FROM bluesky;
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ JSON paths

–î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ Bluesky:
```json
{
  "did": "did:plc:yj3sjq3blzpynh27cumnp5ks",
  "time_us": 1732206349000167,
  "kind": "commit",
  "commit": {
    "collection": "app.bsky.feed.post",
    "operation": "create"
  }
}
```

Document_table –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –∫–æ–ª–æ–Ω–∫–∏:
- `_id` (—Å–ª—É–∂–µ–±–Ω–∞—è)
- `did` (STRING)
- `time_us` (BIGINT)
- `kind` (STRING)
- `commit.collection` (STRING) - –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É!
- `commit.operation` (STRING)

## –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —ç–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º—ã

```sql
-- –ü–µ—Ä–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
INSERT INTO users VALUES ('{"name": "Alice", "age": 30}');
-- –°—Ö–µ–º–∞: [_id, name, age]

-- –í—Ç–æ—Ä–æ–π –¥–æ–∫—É–º–µ–Ω—Ç —Å –Ω–æ–≤—ã–º –ø–æ–ª–µ–º
INSERT INTO users VALUES ('{"name": "Bob", "age": 25, "city": "Moscow"}');
-- –°—Ö–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—à–∏—Ä–∏–ª–∞—Å—å: [_id, name, age, city]

-- –¢—Ä–µ—Ç–∏–π –¥–æ–∫—É–º–µ–Ω—Ç —Å –¥—Ä—É–≥–∏–º —Ç–∏–ø–æ–º –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—è
INSERT INTO users VALUES ('{"name": "Charlie", "age": "thirty"}');
-- –ö–æ–ª–æ–Ω–∫–∞ age —Å—Ç–∞–ª–∞ UNION —Ç–∏–ø–æ–º (BIGINT | STRING)
```

## Union Types

Document_table –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **union types** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ç–∏–ø–æ–≤:
- –ï—Å–ª–∏ –≤ –æ–¥–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤, –æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è UNION
- –ù–∞–ø—Ä–∏–º–µ—Ä: `age` –º–æ–∂–µ—Ç –±—ã—Ç—å `BIGINT | STRING`
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å "–≥—Ä—è–∑–Ω—ã–µ" –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –æ—à–∏–±–æ–∫

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è JSONBench

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞** - –Ω–µ –Ω—É–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –∑–Ω–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
2. **–ö–æ–ª–æ–Ω–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –±—ã—Å—Ç—Ä—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
3. **–ü—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –∫–æ–ª–æ–Ω–∫–∞–º –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ JSON –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
4. **–ì–∏–±–∫–æ—Å—Ç—å** - —Å—Ö–µ–º–∞ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –¥–∞–Ω–Ω—ã–º
5. **Union types** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è Bluesky

```sql
-- –í–º–µ—Å—Ç–æ: j->>'$.commit.collection'
-- –ò—Å–ø–æ–ª—å–∑—É–µ–º: "commit.collection" (–≤ –∫–∞–≤—ã—á–∫–∞—Ö –∏–∑-–∑–∞ —Ç–æ—á–∫–∏)
SELECT "commit.collection" AS event, COUNT(*) 
FROM bluesky 
WHERE kind = 'commit'
GROUP BY event;

-- –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ–ª—è–º –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
SELECT did, kind, time_us 
FROM bluesky 
LIMIT 10;

-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º –ø–æ–ª—è–º
SELECT did 
FROM bluesky 
WHERE "commit.operation" = 'create';
```

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSONBench

### DDL (ddl.sql)
```sql
CREATE TABLE bluesky() WITH (storage='document_table');
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (load_data.py)
```python
# –ü—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤–ª—è–µ–º JSON —Å—Ç—Ä–æ–∫–∏
for record in records:
    json_str = json.dumps(record)
    json_str = json_str.replace("'", "''")
    sql = f"INSERT INTO bluesky VALUES ('{json_str}')"
    conn.execute(sql)
```

### –ó–∞–ø—Ä–æ—Å—ã (queries.sql)
```sql
-- –ò–º–µ–Ω–∞ —Å —Ç–æ—á–∫–∞–º–∏ –≤ –∫–∞–≤—ã—á–∫–∞—Ö
SELECT "commit.collection", COUNT(*) 
FROM bluesky 
GROUP BY "commit.collection";

-- –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–ª—è –±–µ–∑ –∫–∞–≤—ã—á–µ–∫
SELECT did, kind 
FROM bluesky 
WHERE kind = 'commit';
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ë–î

| –ê—Å–ø–µ–∫—Ç | DuckDB/PostgreSQL | Otterbrix document_table |
|--------|-------------------|--------------------------|
| –°—Ö–µ–º–∞ | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (j JSON) | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è (auto) |
| –î–æ—Å—Ç—É–ø –∫ –ø–æ–ª—è–º | `j->>'$.path'` | `"path"` (–ø—Ä—è–º–æ–π) |
| –ù–æ–≤—ã–µ –ø–æ–ª—è | –û—à–∏–±–∫–∞ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è |
| –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ç–∏–ø–æ–≤ | –û—à–∏–±–∫–∞ | Union types |
| –•—Ä–∞–Ω–µ–Ω–∏–µ | Row/Column hybrid | Columnar |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ | –ö–æ–ª–æ–Ω–æ—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è |

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
JSON Document
    ‚Üì json_path_extractor
JSON paths + types
    ‚Üì dynamic_schema
Column definitions (auto-evolving)
    ‚Üì document_to_row
Data chunk
    ‚Üì data_table
Columnar storage
```

## –°—Å—ã–ª–∫–∏

- `/for_ai/document_table/` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ document_table
- `/for_ai/document_table/union_types_complete.md` - –ø—Ä–æ union types
- `/components/document_table/` - –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥

## –°—Ç–∞—Ç—É—Å

‚úÖ Document_table —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
‚úÖ Union types —Ä–∞–±–æ—Ç–∞—é—Ç
‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —ç–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å JSONBench –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

