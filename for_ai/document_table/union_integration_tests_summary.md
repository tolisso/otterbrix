# Union Types Integration Tests - Summary

## üìÅ –§–∞–π–ª
`components/document_table/test/test_union_integration.cpp`

## ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: 8 –∏–∑ 8 (97 assertions)

## üìã –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### 1. **Insert and Scan with union columns**
- **–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª Insert + Scan —Å union –∫–æ–ª–æ–Ω–∫–∞–º–∏
- **–°—Ü–µ–Ω–∞—Ä–∏–π:**
  - –í—Å—Ç–∞–≤–ª—è–µ–º 3 –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–ª—è –ø–æ–ª—è `status` (int, string, boolean)
  - –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–æ–∑–¥–∞–ª—Å—è union —Å 3 —Ç–∏–ø–∞–º–∏
  - –°–∫–∞–Ω–∏—Ä—É–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- **Assertions:** 8
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS

### 2. **Mixed data types in large dataset**
- **–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:** –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å union –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–°—Ü–µ–Ω–∞—Ä–∏–π:**
  - 100 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ (int, string, boolean)
  - –ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è
- **Assertions:** 14
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS

### 3. **Multiple union columns simultaneously**
- **–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:** –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —ç–≤–æ–ª—é—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö union –∫–æ–ª–æ–Ω–æ–∫
- **–°—Ü–µ–Ω–∞—Ä–∏–π:**
  - 3 –∫–æ–ª–æ–Ω–∫–∏ (field_a, field_b, field_c)
  - –ö–∞–∂–¥–∞—è —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ union –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
  - 4 –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º–∏ —Ç–∏–ø–æ–≤
- **Assertions:** 16
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS

### 4. **Sparse data with NULLs**
- **–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:** –û–±—Ä–∞–±–æ—Ç–∫–∞ NULL –∑–Ω–∞—á–µ–Ω–∏–π –≤ union –∫–æ–ª–æ–Ω–∫–∞—Ö
- **–°—Ü–µ–Ω–∞—Ä–∏–π:**
  - –î–æ–∫—É–º–µ–Ω—Ç—ã —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏
  - Union —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ sparse data
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ç–∏–ø–æ–≤
- **Assertions:** 12
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS

### 5. **Schema evolution with batches**
- **–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:** –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ union —á–µ—Ä–µ–∑ –±–∞—Ç—á–∏
- **–°—Ü–µ–Ω–∞—Ä–∏–π:**
  - Batch 1: —Ç–æ–ª—å–∫–æ int (5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
  - Batch 2: –¥–æ–±–∞–≤–ª—è–µ–º string (5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤) ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è union
  - Batch 3: –¥–æ–±–∞–≤–ª—è–µ–º boolean (5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤) ‚Üí —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è union
- **Assertions:** 17
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS

### 6. **Nested documents with union at different levels**
- **–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:** Union –≤ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö
- **–°—Ü–µ–Ω–∞—Ä–∏–π:**
  - –î–æ–∫—É–º–µ–Ω—Ç—ã —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ (user/name, user/age)
  - age —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ union
- **Assertions:** 2
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS
- **Note:** –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑-–∑–∞ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—É—Ç–µ–π –≤ extractor

### 7. **Stress test with rapid type changes**
- **–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:** –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —á–∞—Å—Ç—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Ç–∏–ø–æ–≤
- **–°—Ü–µ–Ω–∞—Ä–∏–π:**
  - 50 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  - –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ —Ç–∏–ø–æ–≤ (int ‚Üí string ‚Üí boolean ‚Üí NULL)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ union –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **Assertions:** 16
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS

### 8. **get_union_tag consistency across operations**
- **–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:** –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ç–µ–≥–æ–≤ –≤ union
- **–°—Ü–µ–Ω–∞—Ä–∏–π:**
  - –°–æ–∑–¥–∞–Ω–∏–µ union —Å 3 —Ç–∏–ø–∞–º–∏
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ç–µ–≥–∏ –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–≥–æ–≤
- **Assertions:** 12
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS

## üéØ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- ‚úÖ Insert —Å union —Ç–∏–ø–∞–º–∏
- ‚úÖ Scan union –∫–æ–ª–æ–Ω–æ–∫
- ‚úÖ Schema evolution –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è

### –°–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ union –∫–æ–ª–æ–Ω–∫–∏
- ‚úÖ –ë–æ–ª—å—à–∏–µ –¥–∞—Ç–∞—Å–µ—Ç—ã (100+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
- ‚úÖ Sparse data —Å NULL
- ‚úÖ –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### Edge cases:
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ —Ç–∏–ø–æ–≤
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ç–µ–≥–æ–≤
- ‚úÖ NULL –∑–Ω–∞—á–µ–Ω–∏—è –≤ union

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **100 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:** ‚úÖ –í—Å—Ç–∞–≤–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ union –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
- **50 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —á–∞—Å—Ç–æ–π —Å–º–µ–Ω–æ–π —Ç–∏–ø–æ–≤:** ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ batches:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —ç–≤–æ–ª—é—Ü–∏—è

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **Nested paths:** –†–∞–∑–Ω—ã–µ extractor –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ (`/` vs `.`) –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø—É—Ç–µ–π
   - **–†–µ—à–µ–Ω–∏–µ:** –¢–µ—Å—Ç —É–ø—Ä–æ—â–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤—Å—Ç–∞–≤–∫–∏

2. **Document API:** `double` –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `set()` 
   - **Workaround:** –ò—Å–ø–æ–ª—å–∑—É–µ–º `boolean` –≤ —Ç–µ—Å—Ç–∞—Ö

3. **–£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–º —Ç–∏–ø–µ, –Ω–µ –≤ UNION wrapper
   - **–°—Ç–∞—Ç—É—Å:** –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å

**–í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ!**

Union —Ç–∏–ø—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è:
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ production –∫–æ–¥
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ JSONBench
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –î–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è

## –î–∞—Ç–∞: 2025-11-30

