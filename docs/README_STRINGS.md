# Документация: Работа со строками в Otterbrix

## Обзор

Этот набор документов содержит полное описание работы со строками (VARCHAR/String) в базе данных Otterbrix. Документы охватывают все уровни архитектуры: от логических значений до Arrow экспорта.

## Файлы документации

### 1. **STRINGS_INDEX.md** (7.3K)
Навигационный индекс и путеводитель по всей документации.

Содержит:
- Быстрый доступ к всем документам
- Структурированные пути обучения (10 мин, 30 мин, 1-2 часа)
- Таблицы компонентов и методов
- FAQ с ответами
- Ссылки на исходные файлы проекта

**Начните отсюда** - это отличная отправная точка.

### 2. **STRING_EXAMPLES.md** (24K)
Подробные примеры кода и объяснения с примерами использования.

Содержит 7 разделов:
1. Обзор системы компонентов
2. Логический уровень (logical_value_t) - создание и работа
3. Вектор уровень (vector_t) - вставка и чтение через set_value
4. Unified формат - работа с unified_vector_format
5. Append операции - arrow_string_data_t и процесс добавления
6. Конвертация - между std::string и внутренним представлением
7. Практические примеры:
   - Пример 1: Вставка и чтение строк
   - Пример 2: Работа с unified_vector_format
   - Пример 3: Работа с data_chunk
   - Пример 4: Массивы и списки строк
8. Диаграмма архитектуры

**Лучше всего для изучения архитектуры** - содержит самое подробное объяснение.

### 3. **FILES_REFERENCE.md** (13K)
Справочник файлов, компонентов и функций.

Содержит:
- Таблица 18 ключевых файлов с их назначением
- Диаграмма структуры потока данных
- Таблица ключевых функций для создания, чтения, append операций
- Конкретные примеры кода из каждого файла
- Таблица различий между типами векторов
- Быстрая справка "Как сделать..."

**Лучше всего для быстрого поиска** - идеальная шпаргалка.

### 4. **STRINGS_SUMMARY.txt** (8.8K)
Краткий обзор и сводка всех ключевых моментов.

Содержит:
- Полный список основных файлов с путями
- Описание 5 ключевых компонентов
- ASCII диаграмма потока данных
- 4 основные операции с описанием
- Важные нюансы (хранение, индексация, NULL, память)
- 4 практических примера

**Лучше всего для быстрого ознакомления** - минимум информации, максимум пользы.

## Рекомендуемый порядок чтения

### Для новичков (30-45 минут)
1. Прочитайте STRINGS_SUMMARY.txt полностью
2. Посмотрите диаграмму в STRING_EXAMPLES.md (раздел 7)
3. Изучите пример 1 в STRING_EXAMPLES.md (раздел 6)
4. Используйте STRINGS_INDEX.md для навигации

### Для разработчиков (1-2 часа)
1. Начните с STRINGS_INDEX.md - пройдите путь на 30 минут
2. Прочитайте разделы 1-4 STRING_EXAMPLES.md
3. Изучите примеры в FILES_REFERENCE.md
4. Посмотрите реальный код в test_vector.cpp (строки 48-167)

### Для глубокого изучения (2-4 часа)
1. Прочитайте ВСЮ документацию в порядке, указанном выше
2. Откройте исходные файлы:
   - /home/tolisso/diploma/otterbrix/components/vector/vector.hpp
   - /home/tolisso/diploma/otterbrix/components/vector/vector.cpp
   - /home/tolisso/diploma/otterbrix/components/vector/tests/test_vector.cpp
3. Экспериментируйте - напишите свои примеры

## Ключевые концепции

### Четыре уровня архитектуры

```
1. logical_value_t   - Логический уровень (std::string)
                     ↓
2. vector_t         - Уровень хранения (std::string_view[])
                     ↓
3. unified_vector_format - Унификация (абстракция доступа)
                     ↓
4. ArrowArray       - Стандартный формат (C Data Interface)
```

### Три главных вопроса, на которые отвечает документация

1. **Как вставить строку?**
   - Создайте logical_value_t из std::string
   - Вызовите vector_t::set_value()
   - Детали в STRING_EXAMPLES.md разделе 2

2. **Как получить строку?**
   - Получите логическое значение через vector_t::value()
   - Извлеките строку через value.value<std::string*>()
   - Детали в STRING_EXAMPLES.md разделе 2

3. **Как работать с большим количеством строк?**
   - Используйте unified_vector_format
   - Работайте с std::string_view для эффективности
   - Детали в STRING_EXAMPLES.md разделе 3-4

## Быстрая справка

### Создать логическое значение
```cpp
logical_value_t val{std::string("hello")};
```

### Вставить строку в вектор
```cpp
v.set_value(index, logical_value_t{std::string("hello")});
```

### Получить строку из вектора
```cpp
std::string str = *(v.value(index).value<std::string*>());
```

### Работать с unified_vector_format
```cpp
unified_vector_format format(resource, count);
v.to_unified_format(count, format);
auto string_data = format.get_data<std::string_view>();
```

Полные примеры: FILES_REFERENCE.md раздел "Быстрая справка"

## Статистика документации

| Документ | Размер | Строк | Тема |
|----------|--------|-------|------|
| STRINGS_INDEX.md | 7.3K | ~120 | Навигация и FAQ |
| STRING_EXAMPLES.md | 24K | ~550 | Подробные примеры |
| FILES_REFERENCE.md | 13K | ~280 | Справочник функций |
| STRINGS_SUMMARY.txt | 8.8K | ~160 | Краткий обзор |
| **ИТОГО** | **53K** | **~1110** | - |

## Исходные файлы проекта

Документация основана на анализе следующих файлов Otterbrix:

### Основные компоненты
- `/home/tolisso/diploma/otterbrix/components/types/logical_value.hpp` - логические значения
- `/home/tolisso/diploma/otterbrix/components/types/logical_value.cpp` - реализация
- `/home/tolisso/diploma/otterbrix/components/vector/vector.hpp` - определение вектора
- `/home/tolisso/diploma/otterbrix/components/vector/vector.cpp` - реализация вектора
- `/home/tolisso/diploma/otterbrix/components/vector/vector_buffer.hpp` - буферы
- `/home/tolisso/diploma/otterbrix/components/vector/vector_buffer.cpp` - реализация буферов

### Arrow обработка
- `/home/tolisso/diploma/otterbrix/components/vector/arrow/appender/string_data.hpp` - append для строк
- `/home/tolisso/diploma/otterbrix/components/vector/arrow/arrow_appender.cpp` - реализация appender
- `/home/tolisso/diploma/otterbrix/components/vector/arrow/arrow_string_view.hpp` - представление строк

### Тесты
- `/home/tolisso/diploma/otterbrix/components/vector/tests/test_vector.cpp` - примеры использования
- `/home/tolisso/diploma/otterbrix/components/vector/tests/test_arrow_conversion.cpp` - тесты Arrow

## Как использовать эту документацию

### Если у вас есть конкретный вопрос:
1. Найдите его в STRINGS_INDEX.md разделе "Часто задаваемые вопросы"
2. Перейдите по ссылке к нужному разделу
3. Изучите код и примеры

### Если вы хотите понять архитектуру:
1. Начните с STRINGS_SUMMARY.txt
2. Прочитайте диаграмму в STRING_EXAMPLES.md
3. Изучите практические примеры

### Если вам нужна быстрая справка:
1. Откройте FILES_REFERENCE.md
2. Найдите нужную функцию в таблице
3. Скопируйте нужный пример кода

### Если вы хотите написать код:
1. Используйте "Быструю справку" в FILES_REFERENCE.md
2. Адаптируйте примеры под свои нужды
3. Обратитесь к STRING_EXAMPLES.md для деталей

## Обновления и исправления

Документация была создана 14 ноября 2025 года на основе анализа исходного кода Otterbrix.

Если вы найдете неточности или неясности:
1. Проверьте исходные файлы проекта
2. Сравните с актуальной версией кода
3. Обновите документацию если необходимо

## Лицензия и авторство

Эта документация создана на основе анализа открытого исходного кода проекта Otterbrix.
Предназначена для образовательных и учебных целей.

## Контрольный список для начинающих

Используйте этот список для проверки своего понимания:

- [ ] Я знаю, что такое logical_value_t и как его создать
- [ ] Я знаю, как вставить строку в vector_t
- [ ] Я знаю, как получить строку из vector_t
- [ ] Я понимаю, что такое unified_vector_format
- [ ] Я знаю, как работать со string_vector_buffer_t
- [ ] Я знаю, как обрабатываются NULL значения
- [ ] Я знаю, как строки экспортируются в Arrow
- [ ] Я могу написать простой пример с вставкой и чтением строк

Если все пункты отмечены - вы готовы к написанию кода!

